<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monster Cards Battle Judge </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .step-container { transition: all 0.5s ease; overflow: hidden; }
        
        /* 選択中のチップスタイル（枠を赤く強調） */
        .chip-selected {
            border-color: #ef4444 !important; /* red-500 */
            border-width: 2px !important;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.3);
            background-color: rgba(239, 68, 68, 0.1) !important;
        }

        html { scroll-behavior: smooth; }
        
        /* 選択肢がフワッと出るアニメーション */
        .fade-in-step {
            animation: fadeIn 0.4s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen p-4 md:p-8">
    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-3xl font-bold text-blue-400 mb-2">Monster Cards Battle Judge</h1>
            <p class="text-slate-400 text-sm">Created by Gemini&Kojiro</p>
        </header>

        <!-- 初期短針設定 -->
        <div class="bg-slate-800 rounded-xl p-6 mb-8 border border-slate-700 shadow-xl">
              <div class="flex flex-col items-center gap-4">
                <div class="text-center"> <label class="font-bold text-orange-400">短針(有利効果):</label>
                       <p class="text-xs text-slate-400 mt-1">マイナスなほど防衛側が有利</p>
                          </div>

                        <div id="needle-options" class="flex flex-wrap gap-2 justify-center bg-slate-700 p-2 rounded-xl">
                      </div>
                     <input type="hidden" id="initial-needle" value="0">
                  </div>
             </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
            <!-- DEFENDER (防御側) -->
            <div id="defender-panel" class="card-panel bg-blue-900/10 border-2 border-blue-500/20 rounded-2xl p-6 shadow-2xl">
                <h2 class="text-xl font-bold text-blue-400 mb-6 flex items-center gap-2">
                    <span class="w-3 h-3 bg-blue-500 rounded-full"></span>
                    DEFENDER (防御側)
                </h2>
                <div id="defender-steps" class="space-y-6">
                    <!-- ステップが生成される -->
                </div>
            </div>

            <!-- ATTACKER (攻撃側) -->
            <div id="attacker-panel" class="card-panel bg-red-900/10 border-2 border-red-500/20 rounded-2xl p-6 shadow-2xl opacity-50 pointer-events-none transition-opacity duration-500">
                <h2 class="text-xl font-bold text-red-400 mb-6 flex items-center gap-2">
                    <span class="w-3 h-3 bg-red-500 rounded-full"></span>
                    ATTACKER (攻撃側)
                </h2>
                <div id="attacker-steps" class="space-y-6">
                    <!-- ステップが生成される -->
                </div>
            </div>
        </div>

        <!-- 判定ボタン -->
        <div id="judge-action" class="hidden text-center mb-10 fade-in-step">
            <button id="judge-btn" class="w-full md:w-auto bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 px-16 rounded-full shadow-lg transition-transform active:scale-95 text-xl">
                決闘開始
            </button>
        </div>

        <!-- 結果表示 -->
        <div id="result-container" class="hidden animate-in fade-in slide-in-from-bottom-4 duration-500">
            <div class="bg-slate-800 border border-slate-700 rounded-xl p-8 text-center shadow-2xl overflow-hidden relative">
                <div id="result-bg" class="absolute inset-0 opacity-10 pointer-events-none"></div>
                <h3 class="text-2xl font-bold mb-4">判定結果</h3>
                <div class="flex justify-center items-center gap-8 mb-6">
                    <div class="text-center">
                        <div class="text-sm text-slate-400 mb-1">最終短針値</div>
                        <div id="final-needle-val" class="text-5xl font-black">0</div>
                    </div>
                </div>
                <div id="winner-text" class="text-4xl font-black tracking-widest mb-6">DRAW</div>
                <div id="matchup-details" class="grid grid-cols-1 md:grid-cols-2 gap-4 text-left mt-6 mb-8"></div>
                
                <button id="rematch-btn" class="relative z-20 w-full md:w-auto bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 px-12 rounded-full border border-slate-500 shadow-lg transition-all active:scale-95">
                    再戦
                </button>
            </div>
        </div>
        
        <div class="h-20"></div>
    </div>

    <script>
        // 設定データ
        const Config = {
            categories: [
                { id: 'element', label: 'Element (属性)', options: ['Normal', 'Water', 'Wood', 'Fire', 'Light', 'Dark'] },
                { id: 'species', label: 'Species (種族)', options: ['Human', 'Beast', 'Sea', 'elemental', 'dragon', 'god', 'devil', 'machine', 'insect', 'ghost'] },
                { id: 'size', label: 'Size (サイズ)', options: ['small', 'medium', 'large'] },
                { id: 'means', label: 'Means (手段)', options: ['close', 'range', 'magic', 'special', 'guard'] }
            ]
        };

        // 相性ロジック (一切変更なし)
        const JudgeLogic = {
            element: (atk, def) => {
                const attackerAdvantage = { 'Fire': ['Wood'], 'Wood': ['Water'], 'Water': ['Fire'], 'Light': ['Dark'], 'Dark': ['Light'] };
                const defenderAdvantage = { 'Normal':['Normal'],'Fire': ['Water'], 'Water': ['Wood'], 'Wood': ['Fire'], 'Light': ['Light'], 'Dark': ['Dark'] };
                if (attackerAdvantage[atk] && attackerAdvantage[atk].includes(def)) return 1;
                if (defenderAdvantage[def] && defenderAdvantage[def].includes(atk)) return -1;
                return 0;
            },
            species: (atk, def) => {
                const attackerAdvantage = { 'human': ['beast','sea','dragon','god','insect'], 'beast': ['sea','dragon','insect'], 'sea': ['dragon','devil','machine','insect'], 'element': ['ghost'], 'dragon': ['human','sea','dragon','devil','insect'], 'god': ['human','beast','dragon','ghost'], 'devil': ['human','dragon','devil','insect'], 'machine': ['human','beast','dragon','insect'], 'insect': ['element','god','machine'], 'ghost' : ['human','machine','ghost'] };
                const defenderAdvantage = { 'Human': ['Beast','Sea','elemental','insect'], 'Beast': ['Sea','elemental','insect'], 'Sea': ['devil','machine','insect'], 'elemental':['Human','Sea','elemental','devil','ghost'], 'dragon':['insect'], 'god': ['Beast','elemental','devil','ghost'], 'devil': ['Human','elemental','god','insect'], 'machine': ['Human','Beast','elemental','dragon'], 'insect':['elemental','god'], 'ghost':['Human','machine'] };
                const a = atk.toLowerCase(); const d = def.toLowerCase();
                for (let key in attackerAdvantage) { if (key.toLowerCase() === a && attackerAdvantage[key].map(i => i.toLowerCase()).includes(d)) return 1; }
                for (let key in defenderAdvantage) { if (key.toLowerCase() === d && defenderAdvantage[key].map(i => i.toLowerCase()).includes(a)) return -1; }
                return 0;
            },
            size: (atk, def) => {
                if ((atk === 'small' && def === 'large') || (atk === 'medium' && def === 'small') || (atk === 'large' && def === 'medium')) return 1;
                if ((def === 'small' && atk === 'large') || (def === 'medium' && atk === 'small') || (def === 'large' && atk === 'medium')) return -1;
                return 0;
            },
            means: (atk, def) => {
                if (atk === 'close' && def === 'range') return -1;
                if (atk === 'range' && def === 'magic') return -1;
                if (atk === 'magic' && def === 'close') return -1;
                if (atk === 'guard' && def === 'special') return -1;
                if (atk === 'special' && def === 'guard') return 1;
                if (atk === 'close' && def === 'special') return 1;
                if (atk === 'range' && def === 'special') return 1;
                if (atk === 'magic' && def === 'special') return 1;
                if (atk === 'range' && def === 'close') return 1;
                if (atk === 'magic' && def === 'range') return 1;
                if (atk === 'close' && def === 'magic') return 1;
                if (atk === 'guard' && (def === 'close' || def === 'range' || def === 'magic')) return -1;
                if (def === 'guard' && (atk === 'close' || atk === 'range' || atk === 'magic')) return -1;
                return 0;
            }
        };

        // 状態管理
        let state = {
            initialNeedle: 0,
            defender: {},
            attacker: {},
            lastWinner: 'none'
        };

        // UI初期化
        function init() {
            renderNeedleOptions();
            renderSteps('defender');
            renderSteps('attacker');
        }

        // 短針ボタンの生成 (innerHTMLをリセットして無限追加を防ぐ)
        function renderNeedleOptions() {
            const container = document.getElementById('needle-options');
            container.innerHTML = ''; 
            for(let i = -4; i <= 4; i++) {
                const btn = document.createElement('button');
                btn.textContent = (i > 0 ? "+" : "") + i;
                // 短針も選択時は赤枠にする
                const isSelected = state.initialNeedle === i;
                btn.className = `w-11 h-11 rounded-lg text-sm font-bold transition-all bg-slate-800 border ${isSelected ? 'chip-selected' : 'border-slate-600 hover:border-slate-400'}`;
                btn.onclick = () => {
                    state.initialNeedle = i;
                    document.getElementById('initial-needle').value = i;
                    renderNeedleOptions();
                };
                container.appendChild(btn);
            }
        }

        // ステップUIの生成
        function renderSteps(side) {
            const container = document.getElementById(`${side}-steps`);
            container.innerHTML = '';
            
            Config.categories.forEach((cat, index) => {
                const stepDiv = document.createElement('div');
                stepDiv.id = `${side}-step-${cat.id}`;
                stepDiv.className = `step-container fade-in-step ${index === 0 ? '' : 'hidden'}`;
                
                stepDiv.innerHTML = `
                    <label class="block text-xs uppercase tracking-wider text-slate-400 mb-2">${cat.label}</label>
                    <div class="flex flex-wrap gap-2">
                        ${cat.options.map(opt => `
                            <button 
                                onclick="selectOption('${side}', '${cat.id}', '${opt}', ${index})"
                                id="btn-${side}-${cat.id}-${opt}"
                                class="chip-btn px-4 py-2 bg-slate-800 border border-slate-700 rounded-lg text-sm transition-all hover:border-slate-500"
                            >${opt}</button>
                        `).join('')}
                    </div>
                `;
                container.appendChild(stepDiv);
            });
        }

        // オプション選択時
        window.selectOption = (side, catId, value, index) => {
            state[side][catId] = value;
            
            // ボタンのハイライト更新（既存の chip-selected を消して新しいものに付与）
            const buttons = document.querySelectorAll(`[id^="btn-${side}-${catId}-"]`);
            buttons.forEach(b => b.classList.remove('chip-selected'));
            
            const targetBtn = document.getElementById(`btn-${side}-${catId}-${value}`);
            if (targetBtn) targetBtn.classList.add('chip-selected');

            // 次のステップを表示
            const nextCat = Config.categories[index + 1];
            if (nextCat) {
                const nextEl = document.getElementById(`${side}-step-${nextCat.id}`);
                if (nextEl) nextEl.classList.remove('hidden');
            } else if (side === 'defender') {
                // 防御側が完了したら攻撃側を活性化
                document.getElementById('attacker-panel').classList.remove('opacity-50', 'pointer-events-none');
            } else {
                // 攻撃側も完了したら判定ボタンを表示
                document.getElementById('judge-action').classList.remove('hidden');
                setTimeout(() => window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' }), 100);
            }
        };

        // 判定実行
        document.getElementById('judge-btn').onclick = () => {
            let currentNeedle = state.initialNeedle;
            const details = [];

            Config.categories.forEach(cat => {
                const res = JudgeLogic[cat.id](state.attacker[cat.id], state.defender[cat.id]);
                currentNeedle += res;
                let colorClass = res > 0 ? "text-red-400" : (res < 0 ? "text-blue-400" : "text-slate-400");
                let statusText = res > 0 ? "攻撃有利 (+1)" : (res < 0 ? "防御有利 (-1)" : "引き分け");
                details.push(`
                    <div class="bg-slate-700/40 p-4 rounded-xl border border-slate-600 flex justify-between items-center">
                        <div>
                            <div class="text-[10px] uppercase text-slate-500 font-bold mb-1">${cat.id}</div>
                            <div class="text-sm font-bold ${colorClass}">${statusText}</div>
                        </div>
                    </div>`);
            });

            const winnerTextEl = document.getElementById('winner-text');
            const resultBg = document.getElementById('result-bg');
            document.getElementById('final-needle-val').textContent = (currentNeedle > 0 ? "+" : "") + currentNeedle;
            document.getElementById('matchup-details').innerHTML = details.join('');

            if (currentNeedle > 0) {
                state.lastWinner = 'attacker';
                winnerTextEl.textContent = "ATTACKER WIN";
                winnerTextEl.className = "text-4xl font-black tracking-widest mb-6 text-red-500";
                resultBg.className = "absolute inset-0 opacity-20 pointer-events-none bg-red-600";
            } else if (currentNeedle < 0) {
                state.lastWinner = 'defender';
                winnerTextEl.textContent = "DEFENDER WIN";
                winnerTextEl.className = "text-4xl font-black tracking-widest mb-6 text-blue-500";
                resultBg.className = "absolute inset-0 opacity-20 pointer-events-none bg-blue-600";
            } else {
                state.lastWinner = 'draw';
                winnerTextEl.textContent = "DRAW";
                winnerTextEl.className = "text-4xl font-black tracking-widest mb-6 text-slate-400";
                resultBg.className = "absolute inset-0 opacity-20 pointer-events-none bg-slate-500";
            }

            document.getElementById('result-container').classList.remove('hidden');
            setTimeout(() => window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' }), 100);
        };

        // 再戦
        document.getElementById('rematch-btn').onclick = () => {
            if (state.lastWinner === 'defender') {
                const savedDefender = { ...state.defender };
                resetUI();
                // コピー実行
                Object.keys(savedDefender).forEach((catId, index) => {
                    selectOption('attacker', catId, savedDefender[catId], index);
                });
            } else {
                resetUI();
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        function resetUI() {
            state.defender = {};
            state.attacker = {};
            document.getElementById('result-container').classList.add('hidden');
            document.getElementById('judge-action').classList.add('hidden');
            document.getElementById('attacker-panel').classList.add('opacity-50', 'pointer-events-none');
            renderSteps('defender');
            renderSteps('attacker');
        }

        init();
    </script>
</body>

</html>
